<html>
	<head>
		<meta charset="utf-8">
		<title>w34's homework</title>
        <style>
            * {
                box-sizing: border-box;
              }
               
              body {
                font-family: Arial;
                padding: 10px;
                background: #FFD700;
                border: 1px;
              }
              footer{
                background: #FFA500;
                clear: both;
                text-align: center;
              }
              .top{
                float: left;
                width: 1800px;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: red;
              }
              .aboutme{
                float: left;
                width: 145px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
              }
              .search{
                float: left;
                width: 1338px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
              }
              .states{
                float: right;
                width: 204px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
              }
              .close{
                float: right;
                width: 63px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
              }
              .middle{
                width: 1800px;
                float: left;
                background-color: #f1f1f1;
                border-style: solid;
                border-width: 5px;
                border-color: red;
              }
              .middle-left{
                float: left;
                text-align: center;
                width: 150px;
                height: 720px;
                background-color: green;
                border-style: solid;
                border-width: 2px;
                border-color: #FFA500;
              }
              .videostream{
                float: left;
                text-align: center;
                width: 1440px;
                height: 720px;
              }
              .middle-right{
                float: left;
                width: 200px;
                height: 720px;
                background-color: #3b3636;
              }
              .time{
                text-align: center;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: #FFA500;
              }
              .none1{
                height: 294px;
                text-align: center;
                border-style: solid;
                border-width: 2px;
                border-color: #b89a64;
              }
              .like{
                text-align: center;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: #FFA500;
              }
              .comment{
                text-align: center;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: #FFA500;
              }
              .subscribe{
                text-align: center;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: #FFA500;
              }
              .forward{
                text-align: center;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: #FFA500;
              }
              .bottom{
                float: left;
                width: 1800px;
                background-color: green;
                border-style: solid;
                border-width: 5px;
                border-color: blue;
              }
              .news{
                float: left;
                width: 700px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
                margin-right: 100px;
              }
              .next{
                float: left;
                width: 100px;
                height: 57px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
                text-align: center;
                margin-right: 100px;
              }
              .tags{
                float: left;
                width: 400px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
                margin-right: 100px;
              }
              .report{
                float: left;
                width: 60px;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                margin: 5px;
                text-align: center;
              }
              .sidebar {
                position: fixed;
                top: 0;
                right: -300px; /* 初始时将侧边栏移出屏幕 */
                width: 300px;
                height: 900px;
                background-color: #f0f0f0;
                border-style: solid;
                border-width: 2px;
                border-color: red;
                transition: right 0.3s ease; /* 添加过渡效果，使侧边栏平滑滑入滑出 */
                z-index: 998; /* 设置侧边栏的层级，使其在上方显示 */
              }
              .buttonCloseComment{
                position: fixed;
                top: 400px;
                right: -300px;
                width: 30px;
                height: 90px;
                transition: right 0.3s ease;
                z-index: 999;
              }
              .sidebar.active {
                right: 0px; /* 通过添加 active 类将侧边栏滑入屏幕 */
              }
              .buttonCloseComment.active{
                right: 300px;
              }
        </style>
	</head>
	<body>
    <div class="top">
        <div class="aboutme">
            <!-- <p>个人页</p> -->
            <img src="src/user_Me.png" alt="我的用户头像" width="70" height="70"><br>
            <script>
              function getMyPng(){
                var myPageRequest = new XMLHttpRequest();
                myPageRequest.onreadystatechange = function() {
                  if (myPageRequest.readyState === XMLHttpRequest.DONE) {
                    if (myPageRequest.status === 200) {
                      var myPage = JSON.parse(myPageRequest.responseText);
                      videoSource.src=myPage.url;
                      changeCommentPage(myPage.id);
                    } else {
                      console.error('个人页请求失败');
                    }
                  }
                };
                myPageRequest.open('GET', 'getMyPng.php', true);
                myPageRequest.send();
              }
            </script>
        </div>
        <div class="search">
            <p id="textSearch">搜索</p>
            <script>
              var textSearch=document.getElementById('textSearch');
            </script>
        </div>
        <div class="close">
            <!-- <p>关闭</p> -->
            <img id="imgClose" src="src/close.png" alt="">
        </div>
        <div class="states">
            <!-- <p>状态栏</p> -->
            <img id="imgStates" src="src/states.png">
        </div>
    </div>
    <div class="middle">
        <div class="middle-left">
            <!-- <p>个人页</p> -->
            <iframe id="myPage" src="login_new.php" width="146" height="716"></iframe>
            <script>
              var username;
              var name;
            </script>
        </div>
        <div class="videostream">
            <!-- <p>视频流</p> -->
            <video id="video" width="1430" height="710" autoplay controls loop>
              <source id="videoSource" src="videos/movie.mp4" type="video/mp4">
              <!-- <source src="movie.ogg" type="video/ogg"> -->
            您的浏览器不支持Video标签,视频无法显示。
            </video>
            <script>
              var video=document.getElementById('video');
              var videoSource=document.getElementById('videoSource');
              var videoID=11;
              function getCurrentVideoID(){
                return videoID;
              }
            </script>
        </div>
        <div class="middle-right">
            <div class="time">
                <!-- <p>时间</p> -->
                <p id="currentTime"></p>
                <script>
                  function formatTime(time) {
                    return time < 10 ? "0" + time : time;
                  }
                  function updateTime() {
                    var now = new Date();
                    var hours = formatTime(now.getHours());
                    var minutes = formatTime(now.getMinutes());
                    var seconds = formatTime(now.getSeconds());
                    var timeString = hours + ":" + minutes + ":" + seconds;
                    var timezoneOffset = getTimezoneOffsetString(now.getTimezoneOffset());
                    var timeZoneString = " UTC" + timezoneOffset;
                    document.getElementById("currentTime").innerHTML = timeString + timeZoneString;
                  }
                  function getTimezoneOffsetString(offset) {
                    var hours = Math.floor(Math.abs(offset) / 60);
                    var minutes = Math.abs(offset) % 60;
                    var sign = offset > 0 ? "-" : "+";
                    var offsetString = sign + formatTime(hours) + ":" + formatTime(minutes);
                    return offsetString;
                  }
                  setInterval(updateTime, 1000);
                </script>                
            </div>
            <div class="none1">
                <!-- <p>占位置的</p> -->
            </div>
            <div class="like">
                <!-- <p>喜欢</p> -->
                <!-- <button id="buttonLike" style="width: 70px;height: 70px;">点赞</button> -->
                <!-- <button id="buttonLike" style="width: 76px;height: 76px;"></button> -->
                <img id="imgLike" src="src/like0.png">
                <br>
                <b>Count: </b><b id="numLikes">1</b>
                <script>
                  function getUsername(){
                    // 获取 <iframe> 元素
                    var myPage = document.getElementById("myPage");
                    // 获取 <iframe> 中的文档对象
                    var myPageDocument = myPage.contentDocument || myPage.contentWindow.document;
                    var token=myPageDocument.getElementById("token");
                    var usernameRequest = new XMLHttpRequest();
                    usernameRequest.onreadystatechange = function() {
                      if (usernameRequest.readyState === XMLHttpRequest.DONE) {
                        if (usernameRequest.status === 200) {
                          var responseData = JSON.parse(usernameRequest.responseText);
                          username=responseData.username;
                          //test
                          //textSearch.innerHTML=username;
                        } else {
                          console.error('请求失败');
                        }
                      }
                    };
                    if(token!=null){
                      usernameRequest.open('GET', 'getUsername.php?token='+token.innerHTML, true);
                      usernameRequest.send();
                    }
                    else{
                      username=null;
                    }
                    //textSearch.innerHTML=token.innerHTML;
                  }
                  function getName(){
                    // 获取 <iframe> 元素
                    var myPage = document.getElementById("myPage");
                    // 获取 <iframe> 中的文档对象
                    var myPageDocument = myPage.contentDocument || myPage.contentWindow.document;
                    var token=myPageDocument.getElementById("token");
                    var nameRequest = new XMLHttpRequest();
                    nameRequest.onreadystatechange = function() {
                      if (nameRequest.readyState === XMLHttpRequest.DONE) {
                        if (nameRequest.status === 200) {
                          var responseData = JSON.parse(nameRequest.responseText);
                          name=responseData.name;
                          //test
                          //textSearch.innerHTML=name;
                        } else {
                          console.error('请求失败');
                        }
                      }
                    };
                    if(token!=null){
                      nameRequest.open('GET', 'getName.php?token='+token.innerHTML, true);
                      nameRequest.send();
                    }
                    else{
                      name=null;
                    }
                  }
                  //var buttonLike=document.getElementById('buttonLike');
                  var imgLike=document.getElementById('imgLike');
                  var likes=Number(document.getElementById('numLikes').innerHTML);
                  var liked=false;
                  function initLikesState(){
                    //getName();
                    var likesRequest = new XMLHttpRequest();
                    likesRequest.onreadystatechange = function() {
                      if (likesRequest.readyState === XMLHttpRequest.DONE) {
                        if (likesRequest.status === 200) {
                          var responseData = JSON.parse(likesRequest.responseText);
                          var tmp=responseData.id;
                          if(tmp=="1"){
                            liked=true;
                            imgLike.src="src/like1.png";
                          }
                          else{
                            liked=false;
                            imgLike.src="src/like0.png";
                          }
                          //test
                          //textSearch.innerHTML=tmp;
                          //textSearch.innerHTML=username+" "+name+" "+videoID;
                        } else {
                          console.error('请求失败');
                        }
                      }
                    };
                    likesRequest.open('GET', 'getLikesState.php?name='+name+'&videoID='+videoID, true);
                    likesRequest.send();
                  }
                  function updateLikes(likes){
                    document.getElementById("numLikes").innerText=String(likes);
                  }
                  imgLike.addEventListener('click',function(event){
                    if(liked==false){
                      liked=true;
                      likes++;
                      imgLike.src="src/like1.png";
                    }
                    else{
                      liked=false;
                      likes--;
                      imgLike.src="src/like0.png";
                    }
                    updateLikes(likes);
                  });
                </script>
            </div>
            <!-- 评论区页面 -->
            <div class="sidebar" id="sidebar">
              <iframe id="commentPage" src="comment.php?videoID=11"
               frameborder="0" width="300" height="700"></iframe>
              <div class="writeComment" id="writeComment">
                <form id="commentForm" action="writeComment.php" method="post" style="text-align:start;" width="300" height="200">
                  发表评论: <br>
                  <input type="" name="commentText" style="height:80px;width:250px;" 
                  maxlength="200" placeholder="write your comment here"><br>
                  <!-- <input type="submit" value="登录" width="50px" height="50px" style="text-align:center"> -->
                 <input type="hidden" id="tokenForComment" name="token" value=""> 
                 <input type="hidden" id="videoIDForComment" name="videoID" value="">
                </form>
                  <button id="submitComment">提交</button>
              </div> 
              <script>
                var commentPage=document.getElementById('commentPage');
                var submitComment=document.getElementById('submitComment');
                var commentForm = document.getElementById('commentForm');
                var tokenForComment=document.getElementById('tokenForComment');
                var videoIDForComment=document.getElementById('videoIDForComment');
                var submitComment=document.getElementById('submitComment');
                submitComment.addEventListener('click', function(event) {
                  // 获取 <iframe> 元素
                  var myPage = document.getElementById("myPage");
                  // 获取 <iframe> 中的文档对象
                  var myPageDocument = myPage.contentDocument || myPage.contentWindow.document;
                  var token=myPageDocument.getElementById("token");
                  tokenForComment.value=token.innerText;
                  videoIDForComment.value=videoID;
                  //test
                  //textSearch.innerHTML=token.innerText;
                  var commentFormData = new FormData(commentForm);
                  var xhr = new XMLHttpRequest();
                  xhr.onreadystatechange =function(){
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                      if (xhr.status === 200) {
                        commentPage.contentWindow.location.reload();
                      } else {
                        console.error('请求失败');
                      }
                    }
                  };
                  xhr.open('POST', 'writeComment.php');
                  xhr.send(commentFormData);
                });
              </script>
            </div>
            <div class="comment">
                <!-- <p>评论</p> -->
                <!-- <button id="buttonComment" style="width: 70px;height: 70px;">评论</button> -->
                <img id="imgComment" src="src/comment.png">
                <button class="buttonCloseComment" id="buttonCloseComment">></button>
                <script>
                  //var buttonComment=document.getElementById('buttonComment');
                  var imgComment=document.getElementById('imgComment');
                  var buttonCloseComment=document.getElementById('buttonCloseComment');
                  var sidebar=document.getElementById('sidebar');
                  imgComment.addEventListener('click',function(event){
                    sidebar.classList.add('active');
                    buttonCloseComment.classList.add('active');
                  });
                  buttonCloseComment.addEventListener('click',function(event){
                    sidebar.classList.remove('active');
                    buttonCloseComment.classList.remove('active');
                  });
                </script>
            </div>
            <div class="subscribe">
                <!-- <p>订阅</p> -->
                <img src="src/user.png" alt="用户头像" width="80" height="80"><br>
                <!-- <button id="buttonSubscribe">关注</button> -->
                <img id="imgSubscribe" src="src/subscribe.png">
                <script>
                  //var buttonSubscribe=document.getElementById('buttonSubscribe');
                  var imgSubscribe=document.getElementById('imgSubscribe');
                  imgSubscribe.addEventListener('click',function(event){

                  });
                </script>
            </div>
            <div class="forward">
                <!-- <p>转发</p> -->
                <!-- <button id="buttonRelay" style="width: 70px;height: 70px;">转发</button> -->
                <img id="imgRelay" src="src/relay.png">
                <script>
                  //var buttonRelay=document.getElementById('buttonRelay');
                  var imgRelay=document.getElementById('imgRelay');
                  imgRelay.addEventListener('click',function(event){

                  });
                </script>
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="news">
            <p>动态</p>
        </div>
        <div class="next">
            <!-- <p>下一个</p> -->
            <button id="buttonNextVideo" style="width: 96px;height: 54px;">下一个视频</button>
            
        </div>
        <div class="tags">
            <p class="channel" id="channel">标签</p>
        </div>
        <div class="report">
            <p>报告</p>
        </div>
    </div>
    <!-- <div class="loginpage">
        <p>登录页</p>
    </div> -->
	</body>
  <script>
    var channel=document.getElementById("channel");
    function changeVideoTags(tags){
      channel.innerHTML="Tags: "+tags;
    }
    function changeCommentPage(videoID){
      commentPage.src="comment.php?videoID="+videoID;
    }
    function getNextVideo(){
      var result='videos/test.mp4'
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var responseData = JSON.parse(xhr.responseText);
            //console.log(responseData);
            getUsername();
            getName();
            videoID=responseData.id;
            videoSource.src=responseData.url;
            likes=responseData.likes;
            updateLikes(likes);
            initLikesState();
            video.pause();
            video.load();
            video.play();
            changeCommentPage(responseData.id);
            changeVideoTags(responseData.channel);
          } else {
            console.error('请求失败');
          }
        }
      };
      xhr.open('GET', 'getRandomVideo.php', true);
      xhr.send();
    }
    var buttonNextVideo=document.getElementById('buttonNextVideo');
    buttonNextVideo.addEventListener('click',function(event){
      getNextVideo();
    });
  </script>
    <footer>
        <p>版权所有 © w34</p>
    </footer>
</html>
